## ※ Access Token / Refresh Token 이란?

-   Access Token
    -   API를 요청하는데 사용되며, 유효 기간을 짧게 설정해준다.
    -   보통 30분, 짧으면 10분
-   Refresh Token.
    -   Acccess Token을 재발급 받는데 사용되며, 유효기간을 길게 설정해준다.
    -   유효기간 일주일
-   공통점
    -   같은 방식으로 토큰을 만들어준다(구조 같음)
    -   로그인 성공시 같이 생성

<br/>

## ※ 같이 사용하는 이유?

### 1. 엑세스 토큰의 유효시간을 짧게 하는 이유

    - 엑세스 토큰의 경우 API를 요청하여 데이터에 접근할때마다 사용된다.
    - 즉, 사용빈도가 높기 때문에 탈취될 확률도 높다.
    - 하여 유효시간을 줄여 탈취되더라도 해커가 사용할수 있는 시간을 적게한다.

### 2. 더 안전한 이유는 무엇인가?

    - 엑세스토큰을 재발급 받기 위해서는 리프레시 토큰과 엑세스 토큰을 두개 다 필요로 한다.
    - 리프레시 토큰은 오직 엑세스 토큰이 만료되어 엑세스 토큰을 재발급 받을 때만 사용된다.
    - 즉 엑세스 토큰에 비해 사용 빈도수가 적기 때문에 비교적 엑세스 토큰 하나만 사용했을 때보다 안전하다.

### 3. 리프레시 토큰을 DB에 저장하는 이유?

    - 액세스 토큰을 재발급 할때 리프레시 토큰이 정상적으로 서버에서 발급 된것이 맞는지 확인하기 위함이다.


    - 액세스 토큰을 탈취당하더라도 리프레시 토큰을 탈취하지 못하면 공격할 수 있는 시간이 짧다.
    - 액세스 토큰을 재발급 받으로면 리프레시 토큰 + 엑세스 토큰이 같이 있어야한다.
    - 리프레시 토큰은 DB에 { userId: TOKEN } 형태로 저장되며, userId는 엑세스토큰에서 TOKEN은 리프레시 토큰과 일치해야 한다.

## ※ 구현

![이미지](https://t1.daumcdn.net/cfile/tistory/99DB8C475B5CA1C936)

-   사용자 로그인 성공시 Access Token, Refresh 토큰 생성 및 사용자 발급
-   Refresh 토큰은 서버 DB에 저장 { USER_ID: TOKEN } 형태로 저장
-   사용자는 두개의 토큰을 모두 localstorage 저장
-   데이터 요청시에는 Access Token만 헤더에 실어 요청 보냄
-   Access Token 검증하여 유효한 경우 데이터 전송
-   Access Token 유효기간이 끝난 경우 요청시 서버에서 권한 없음을 보냄
-   (사용자 자체적으로 검증하여 바로 재발급 요청을 할 수도 있음)
-   사용자는 Access Token과 Refresh 토큰을 같이 서버로 보냄
-   서버는 DB에 저장되어 있는 Refresh 토큰 정보와 일치하는 지 확인
-   ( 만료된 엑세스 토큰에서 USER_ID를 얻고 리프레시 토큰과 함께 DB에서 찾음 )
-   일치하고 Refresh 유효기간이 지나지 않았다면 Access Token 재발급
-   유효기간이 지났거나 7일 이내라면 Refresh 토큰도 재발급

<br/>
<br/>

## ※ 위험성

-   XSS
    -   Access Token, Refresh Token 모두 localstorage에 저장하게 되면 XSS 공격에 취약할 수 있다.
    -   XSS: cross Site Scripting 해커가 자바스크립트 코드를 웹사이트에 심어 사용자 정보를 탈 취 할 수 있음

## ※ 결론

-   리프레시 토큰을 같이 사용하더라도 보안상의 위험이 따른다.
-   따라서 JWT 인증을 이용할 시에는 HTTPS 프로토콜 통신을 하는 것이 좋다.

## ※ 참고

-   https://soon-devblog.tistory.com/12
-   https://dooopark.tistory.com/6
